define("assignsubmission_reflection/reflectionForm",["exports","core/fragment","core/templates","core/ajax","jquery"],(function(_exports,_fragment,_templates,_ajax,_jquery){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_fragment=_interopRequireDefault(_fragment),_templates=_interopRequireDefault(_templates),_ajax=_interopRequireDefault(_ajax),_jquery=_interopRequireDefault(_jquery);var loadForm=function(contextid,formData){void 0===formData&&(formData={});var params={jsonformdata:JSON.stringify(formData)};document.getElementById("page-mod-assign-grading")?renderReflectionInSubmissionTable():_fragment.default.loadFragment("assignsubmission_reflection","reflectionpanel",contextid,params).done((function(html,js){(0,_jquery.default)(document.querySelector(".reflection-form-container")).fadeOut("fast",(function(){_templates.default.replaceNodeContents((0,_jquery.default)(document.querySelector(".reflection-form-container")),html,js),(0,_jquery.default)(document.querySelector(".reflection-form-container")).fadeIn("fast"),(0,_jquery.default)(document.querySelector(".reflection-form-container form  #id_submitbutton")).on("click",submitFormAjax.bind(this)),document.getElementById("id_submission").value=document.querySelector(".reflection-form-container").getAttribute("data-itemid"),document.getElementById("id_assignment").value=document.querySelector(".reflection-form-container").getAttribute("data-assignment")}))})).fail((function(response){console.log(response)}))},submitFormAjax=function(e){e.preventDefault();var formData=(0,_jquery.default)(document.querySelector(".reflection-form-container form")).serialize(),contextid=document.querySelector(".reflection-form-container").getAttribute("data-contextid"),canedit=document.querySelector(".reflection-form-container").getAttribute("data-editing-enable");_ajax.default.call([{methodname:"assignsubmission_reflection_reflection_form",args:{contextid:contextid,jsonformdata:JSON.stringify(formData),canedit:canedit},done:function(response){console.log(response),responseReflectionDisplay(response)},fail:function(reason){console.log(reason)}}])},responseReflectionDisplay=function(response){switch(console.log(JSON.parse(response)),(response=JSON.parse(response)).result){case"FAIL":if(null==document.querySelector(".cgs-reflection-fail-alert")){(0,_jquery.default)(document.querySelector(".reflection-form-container form")).after("<div class='alert alert-danger cgs-reflection-alert cgs-reflection-fail-alert' role='alert'>There was a problem when saving the reflection. Please try again later</div>")}fadeAlert(".cgs-reflection-fail-alert");break;case"EMPTY":if(null==document.querySelector(".cgs-reflection-empty-alert")){(0,_jquery.default)(document.querySelector(".reflection-form-container form")).after("<div class='alert alert-danger cgs-reflection-alert cgs-reflection-empty-alert' role='alert'>The reflection cannot be empty</div>")}fadeAlert(".cgs-reflection-empty-alert");break;case"SUCCESS_NON_EDITABLE":(0,_jquery.default)(document.querySelector(".reflection-form-container")).fadeOut("fast",(function(){(0,_jquery.default)(document.querySelector(".reflection-form-container")).replaceWith(response.reflection),(0,_jquery.default)(document.querySelector(".reflection-form-container")).fadeIn("fast")}));break;case"SUCCESS_EDITABLE":if(loadForm(document.querySelector(".reflection-form-container").getAttribute("data-contextid"),response.serialiseddata),null==document.querySelector(".cgs-reflection-editing")){(0,_jquery.default)(document.querySelector(".reflection-form-container form")).after('<div class=\'alert alert-success alert-dismissible cgs-reflection-alert cgs-reflection-editing\'>\n                                <button type="button" class="close" data-dismiss="alert">&times;</button>\n                                <strong>Success!</strong> Reflection saved.\n                              </div>'),fadeAlert(".cgs-reflection-editing")}}},fadeAlert=function(alert){(0,_jquery.default)(alert).fadeOut(5e3)},renderReflectionInSubmissionTable=function(){if(null!=document.querySelector(".reflection-form-container")){(0,_jquery.default)("div.reflection-form-container").addClass("text-truncate");var container=document.querySelector(".reflection-form-container"),submission=container.getAttribute("data-itemid"),assignment=container.getAttribute("data-assignment"),context=container.getAttribute("data-contextid");_ajax.default.call([{methodname:"assignsubmission_reflection_get_reflection",args:{submission:submission,assignment:assignment,context:context},done:function(response){console.log(response),document.querySelector(".reflection-form-container").innerHTML=response,(0,_jquery.default)("#more").on("click",(function(e){e.stopPropagation(),(0,_jquery.default)("div.reflection-form-container").hasClass("text-truncate")?((0,_jquery.default)("div.reflection-form-container").removeClass("text-truncate"),(0,_jquery.default)(".assignsubmission_reflection-plus").removeClass("fa-plus"),(0,_jquery.default)(".assignsubmission_reflection-plus").addClass("fa-minus"),document.getElementById("more").setAttribute("title","View summary"),(0,_jquery.default)("div.reflection-form-container").css({height:"auto"})):(document.getElementById("more").setAttribute("title","View full"),(0,_jquery.default)("div.reflection-form-container").addClass("text-truncate"),(0,_jquery.default)(".assignsubmission_reflection-plus").removeClass("fa-minus"),(0,_jquery.default)(".assignsubmission_reflection-plus").addClass("fa-plus"))}))},fail:function(reason){console.log(reason)}}])}};_exports.init=function(contextid,formData){var nonEditable=arguments.length>2&&void 0!==arguments[2]&&arguments[2];nonEditable?(0,_jquery.default)("#view-reflection").on("click",(function(e){e.stopPropagation(),(0,_jquery.default)(".assignsubmission_reflection-non-editable-plus").hasClass("fa-plus")?((0,_jquery.default)(".assignsubmission_reflection-non-editable-plus").removeClass("fa-plus"),(0,_jquery.default)(".assignsubmission_reflection-non-editable-plus").addClass("fa-minus"),(0,_jquery.default)(".summary_assignsubmission_reflection").removeClass("view-summary"),(0,_jquery.default)(".summary_assignsubmission_reflection").addClass("view-full"),document.getElementById("view-reflection").setAttribute("title","View summary")):(document.getElementById("view-reflection").setAttribute("title","View full"),(0,_jquery.default)(".assignsubmission_reflection-non-editable-plus").removeClass("fa-minus"),(0,_jquery.default)(".assignsubmission_reflection-non-editable-plus").removeClass("view-full"),(0,_jquery.default)(".assignsubmission_reflection-non-editable-plus").addClass("fa-plus"),(0,_jquery.default)(".summary_assignsubmission_reflection").addClass("view-summary"))})):loadForm(contextid,formData)}}));

//# sourceMappingURL=reflectionForm.min.js.map