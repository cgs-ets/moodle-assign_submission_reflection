define("assignsubmission_reflection/reflectionForm",["exports","core/fragment","core/templates","core/ajax","jquery"],(function(_exports,_fragment,_templates,_ajax,_jquery){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_fragment=_interopRequireDefault(_fragment),_templates=_interopRequireDefault(_templates),_ajax=_interopRequireDefault(_ajax),_jquery=_interopRequireDefault(_jquery);var loadForm=function(contextid,formData){void 0===formData&&(formData={});var params={jsonformdata:JSON.stringify(formData)};document.getElementById("page-mod-assign-grading")?renderReflectionInSubmissionTable():document.getElementById("page-mod-assign-grader")?assignsubmission_reflection_get_reflection(document.querySelector(".reflection-form-container"),!0):_fragment.default.loadFragment("assignsubmission_reflection","reflectionpanel",contextid,params).done((function(html,js){(0,_jquery.default)(document.querySelector(".reflection-form-container")).fadeOut("fast",(function(){_templates.default.replaceNodeContents((0,_jquery.default)(document.querySelector(".reflection-form-container")),html,js),(0,_jquery.default)(document.querySelector(".reflection-form-container")).fadeIn("fast"),(0,_jquery.default)(document.querySelector(".reflection-form-container form  #id_submitbutton")).on("click",submitFormAjax.bind(this)),document.getElementById("id_submission").value=document.querySelector(".reflection-form-container").getAttribute("data-itemid"),document.getElementById("id_assignment").value=document.querySelector(".reflection-form-container").getAttribute("data-assignment")}))})).fail((function(response){console.log(response)}))},submitFormAjax=function(e){e.preventDefault();var formData=(0,_jquery.default)(document.querySelector(".reflection-form-container form")).serialize(),contextid=document.querySelector(".reflection-form-container").getAttribute("data-contextid"),canedit=document.querySelector(".reflection-form-container").getAttribute("data-editing-enable"),userid=document.querySelector(".reflection-form-container").getAttribute("data-userid");_ajax.default.call([{methodname:"assignsubmission_reflection_reflection_form",args:{contextid:contextid,jsonformdata:JSON.stringify(formData),canedit:canedit,userid:userid},done:function(response){responseReflectionDisplay(response)},fail:function(reason){console.log(reason)}}])},responseReflectionDisplay=function(response){switch((response=JSON.parse(response)).result){case"FAIL":if(null==document.querySelector(".cgs-reflection-fail-alert")){(0,_jquery.default)(document.querySelector(".reflection-form-container form")).after("<div class='alert alert-danger cgs-reflection-alert cgs-reflection-fail-alert' role='alert'>There was a problem when saving the reflection. Please try again later</div>")}fadeAlert(".cgs-reflection-fail-alert");break;case"EMPTY":if(null==document.querySelector(".cgs-reflection-empty-alert")){(0,_jquery.default)(document.querySelector(".reflection-form-container form")).after("<div class='alert alert-danger cgs-reflection-alert cgs-reflection-empty-alert' role='alert'>The reflection cannot be empty</div>")}fadeAlert(".cgs-reflection-empty-alert");break;case"SUCCESS_NON_EDITABLE":(0,_jquery.default)(document.querySelector(".reflection-form-container")).fadeOut("fast",(function(){(0,_jquery.default)(document.querySelector(".reflection-form-container")).replaceWith(response.reflection),(0,_jquery.default)(document.querySelector(".reflection-form-container")).fadeIn("fast")}));break;case"SUCCESS_EDITABLE":if(loadForm(document.querySelector(".reflection-form-container").getAttribute("data-contextid"),response.serialiseddata),null==document.querySelector(".cgs-reflection-editing")){(0,_jquery.default)(document.querySelector(".reflection-form-container form")).after('<div class=\'alert alert-success alert-dismissible cgs-reflection-alert cgs-reflection-editing\'>\n                                <button type="button" class="close" data-dismiss="alert">&times;</button>\n                                <strong>Success!</strong> Reflection saved.\n                              </div>'),fadeAlert(".cgs-reflection-editing")}}},fadeAlert=function(alert){(0,_jquery.default)(alert).fadeOut(5e3)},renderReflectionInSubmissionTable=function(){var cellNumber=Array.from(document.querySelector("table thead tr").children).filter((function(th){if(th.innerHTML.includes("Reflection"))return th}))[0].getAttribute("class").split(" ");cellNumber=cellNumber[cellNumber.length-1],Array.from(document.querySelectorAll("table tbody tr td")).forEach((function(td){if(td.getAttribute("class").includes(cellNumber)){var container=td.querySelector(".reflection-form-container");null!=container?assignsubmission_reflection_get_reflection(container):td.innerHTML='<span class = "reflectionsubmissionstatus">No Reflection</span>'}}))},assignsubmission_reflection_get_reflection=function(container){var fromGraderView=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null!=document.querySelector(".reflection-form-container")){(0,_jquery.default)("div.reflection-form-container").addClass("text-truncate");var submission=container.getAttribute("data-itemid"),assignment=container.getAttribute("data-assignment"),context=container.getAttribute("data-contextid"),userid=container.getAttribute("data-userid");_ajax.default.call([{methodname:"assignsubmission_reflection_get_reflection",args:{submission:submission,assignment:assignment,context:context,userid:userid},done:function(response){fromGraderView?document.querySelector(".reflection-form-container").innerHTML=response:document.querySelector('[data-userid="'.concat(userid,'"]')).innerHTML=response,controlViewFull(userid)},fail:function(reason){console.log(reason)}}])}},controlViewFull=function(userid){(0,_jquery.default)("#more-".concat(userid)).on("click",(function(e){e.stopPropagation(),(0,_jquery.default)('.reflection-form-container[data-userid = "'.concat(userid,'"]')).hasClass("text-truncate")?((0,_jquery.default)('.reflection-form-container[data-userid = "'.concat(userid,'"]')).removeClass("text-truncate"),(0,_jquery.default)("#more-".concat(userid," > i")).removeClass("fa-plus"),(0,_jquery.default)("#more-".concat(userid," > i")).addClass("fa-minus"),document.getElementById("more-".concat(userid)).setAttribute("title","View summary"),(0,_jquery.default)('.reflection-form-container[data-userid = "'.concat(userid,'"]')).css({height:"auto"})):(document.getElementById("more-".concat(userid)).setAttribute("title","View full"),(0,_jquery.default)('.reflection-form-container[data-userid = "'.concat(userid,'"]')).addClass("text-truncate"),(0,_jquery.default)("#more-".concat(userid," > i")).removeClass("fa-minus"),(0,_jquery.default)("#more-".concat(userid," > i")).addClass("fa-plus"))}))};_exports.init=function(contextid,formData){var nonEditable=arguments.length>2&&void 0!==arguments[2]&&arguments[2],userid=arguments.length>3?arguments[3]:void 0;null!=document.getElementById("page-mod-assign-grader")&&null!=document.querySelector("span.reflectionsubmissionstatus")&&document.querySelector("span.reflectionsubmissionstatus").removeAttribute("hidden"),nonEditable?controlViewFull(userid):loadForm(contextid,formData)}}));

//# sourceMappingURL=reflectionForm.min.js.map