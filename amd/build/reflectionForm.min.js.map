{"version":3,"file":"reflectionForm.min.js","sources":["../src/reflectionForm.js"],"sourcesContent":["import Fragment from 'core/fragment';\nimport Templates from 'core/templates';\nimport Ajax from 'core/ajax';\nimport $ from 'jquery';\n\nconst loadForm = (formdata, contextid) => {\n    if (typeof formdata === \"undefined\") {\n        formdata = {};\n    }\n\n    var params = { jsonformdata: JSON.stringify(formdata) };\n\n    Fragment.loadFragment('assignsubmission_reflection', 'reflectionpanel', contextid, params).done(function (html, js) {\n        $(document.querySelector('.reflection-form-container')).fadeOut(\"fast\", function () {\n            Templates.replaceNodeContents($(document.querySelector('.reflection-form-container')), html, js);\n            $(document.querySelector('.reflection-form-container')).fadeIn(\"fast\");\n            $(document.querySelector('.reflection-form-container form  #id_submitbutton')).on('click', submitFormAjax.bind(this));\n            document.getElementById('id_submission').value = document.querySelector('.reflection-form-container').getAttribute('data-itemid');\n            document.getElementById('id_assignment').value = document.querySelector('.reflection-form-container').getAttribute('data-assignment');\n        });\n\n    });\n\n}\n\nconst submitFormAjax = (e) => {\n    // We don't want to do a real form submission.\n    e.preventDefault();\n\n    var formData = $(document.querySelector('.reflection-form-container form')).serialize();\n    var contextid = document.querySelector(\".reflection-form-container\").getAttribute('data-contextid');\n\n    Ajax.call([{\n        methodname: 'assignsubmission_reflection_reflection_form',\n        args: { contextid: contextid,\n                jsonformdata: JSON.stringify(formData)\n            },\n        done: function(response) {\n            console.log(response);\n            switch (response) {\n                case \"FAIL\":\n                    if (document.querySelector('.cgs-reflection-fail-alert') == null) {\n                        const alert1 = \"<div class='alert alert-danger cgs-reflection-alert cgs-reflection-fail-alert' role='alert'>There was a problem when saving the reflection. Please try again later</div>\"\n                        $(document.querySelector('.reflection-form-container form')).after(alert1);\n                    }\n                    break;\n                case \"EMPTY\":\n                    if(document.querySelector('.cgs-reflection-empty-alert') == null) {\n                        const alert2 = \"<div class='alert alert-danger cgs-reflection-alert cgs-reflection-empty-alert' role='alert'>The reflection cannot be empty</div>\"\n                        $(document.querySelector('.reflection-form-container form')).after(alert2);\n                    }\n                break;\n\n                default:\n                    $(document.querySelector('.reflection-form-container')).fadeOut(\"fast\", function () {\n                        $(document.querySelector('.reflection-form-container')).replaceWith(response)\n                        $(document.querySelector('.reflection-form-container')).fadeIn(\"fast\");\n                    })\n                    break;\n            }\n        },\n        fail: function(reason) {\n            console.log(reason);\n\n        }\n    }]);\n\n}\n\nexport const init = (undefined, contextid) => {\n    loadForm('', contextid);\n}\n"],"names":["submitFormAjax","e","preventDefault","formData","document","querySelector","serialize","contextid","getAttribute","call","methodname","args","jsonformdata","JSON","stringify","done","response","console","log","after","fadeOut","replaceWith","fadeIn","fail","reason","undefined","formdata","params","loadFragment","html","js","replaceNodeContents","on","bind","this","getElementById","value","loadForm"],"mappings":"sfAyBMA,eAAiB,SAACC,GAEpBA,EAAEC,qBAEEC,UAAW,mBAAEC,SAASC,cAAc,oCAAoCC,YACxEC,UAAYH,SAASC,cAAc,8BAA8BG,aAAa,gCAE7EC,KAAK,CAAC,CACPC,WAAY,8CACZC,KAAM,CAAEJ,UAAWA,UACXK,aAAcC,KAAKC,UAAUX,WAErCY,KAAM,SAASC,iBACXC,QAAQC,IAAIF,UACJA,cACC,UAC2D,MAAxDZ,SAASC,cAAc,8BAAuC,qBAE5DD,SAASC,cAAc,oCAAoCc,MAD9C,sLAIlB,WAC2D,MAAzDf,SAASC,cAAc,+BAAwC,qBAE5DD,SAASC,cAAc,oCAAoCc,MAD9C,uKAMjBf,SAASC,cAAc,+BAA+Be,QAAQ,QAAQ,+BAClEhB,SAASC,cAAc,+BAA+BgB,YAAYL,8BAClEZ,SAASC,cAAc,+BAA+BiB,OAAO,aAK/EC,KAAM,SAASC,QACXP,QAAQC,IAAIM,2BAOJ,SAACC,YAAWlB,YAhEf,SAACmB,SAAUnB,gBACA,IAAbmB,WACPA,SAAW,QAGXC,OAAS,CAAEf,aAAcC,KAAKC,UAAUY,6BAEnCE,aAAa,8BAA+B,kBAAmBrB,UAAWoB,QAAQZ,MAAK,SAAUc,KAAMC,wBAC1G1B,SAASC,cAAc,+BAA+Be,QAAQ,QAAQ,8BAC1DW,qBAAoB,mBAAE3B,SAASC,cAAc,+BAAgCwB,KAAMC,wBAC3F1B,SAASC,cAAc,+BAA+BiB,OAAO,4BAC7DlB,SAASC,cAAc,sDAAsD2B,GAAG,QAAShC,eAAeiC,KAAKC,OAC/G9B,SAAS+B,eAAe,iBAAiBC,MAAQhC,SAASC,cAAc,8BAA8BG,aAAa,eACnHJ,SAAS+B,eAAe,iBAAiBC,MAAQhC,SAASC,cAAc,8BAA8BG,aAAa,yBAoD3H6B,CAAS,GAAI9B"}