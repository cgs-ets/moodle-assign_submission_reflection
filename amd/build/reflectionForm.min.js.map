{"version":3,"file":"reflectionForm.min.js","sources":["../src/reflectionForm.js"],"sourcesContent":["import Fragment from 'core/fragment';\nimport Templates from 'core/templates';\nimport Ajax from 'core/ajax';\nimport $ from 'jquery';\n\n\nconst loadForm = (formdata, contextid) => {\n    console.log(\"LOAD FORM\");\n    if (typeof formdata === \"undefined\") {\n        formdata = {};\n    }\n\n    var params = { jsonformdata: JSON.stringify(formdata) };\n    console.log(contextid);\n\n    Fragment.loadFragment('assignsubmission_reflection', 'reflectionpanel', contextid, params).done(function (html, js) {\n        // console.log(html);\n        $(document.querySelector('.reflection-form-container')).fadeOut(\"fast\", function () {\n            Templates.replaceNodeContents($(document.querySelector('.reflection-form-container')), html, js);\n            $(document.querySelector('.reflection-form-container')).fadeIn(\"fast\");\n            console.log($(document.querySelector('.reflection-form-container form')));\n            $(document.querySelector('.reflection-form-container form  #id_submitbutton')).on('click', submitFormAjax.bind(this));\n            document.getElementById('id_itemid').value = document.querySelector('.reflection-form-container').getAttribute('data-itemid');\n            // reflection-form-container\n\n            //\n        });\n\n    });\n\n}\n\n\nconst handleFormSubmissionResponse = () => {\n    // We could trigger an event instead.\n    // Yuk.\n    Y.use('moodle-core-formchangechecker', function () {\n        M.core_formchangechecker.reset_form_dirty_state();\n    });\n    //document.location.reload();\n    console.log(\"handleFormSubmissionResponse\");\n};\n\n/**\n   * @method handleFormSubmissionFailure\n   * @private\n   * @return {Promise}\n   */\nconst handleFormSubmissionFailure = (data) => {\n    // Oh noes! Epic fail :(\n    // Ah wait - this is normal. We need to re-display the form with errors!\n    //this.modal.setBody(this.getBody(data));\n    console.log(\"ERROR\");\n};\nconst submitFormAjax = (e) => {\n    // We don't want to do a real form submission.\n    e.preventDefault();\n\n    console.log(\"submitFormAjax\");\n    var changeEvent = document.createEvent('HTMLEvents');\n    changeEvent.initEvent('change', true, true);\n\n\n    var formData = $(document.querySelector('.reflection-form-container form')).serialize();\n    console.log(formData);\n    var contextid = document.querySelector(\".reflection-form-container\").getAttribute('data-contextid');\n    // Now we can continue...\n    Ajax.call([{\n        methodname: 'assignsubmission_reflection_reflection_form',\n        args: { contextid: contextid, jsonformdata: JSON.stringify(formData) },\n        done: handleFormSubmissionResponse.bind(this, formData),\n        fail: handleFormSubmissionFailure.bind(this, formData)\n    }]);\n\n\n}\n\nexport const init = (undefined, contextid) => {\n    loadForm('', contextid);\n}\n"],"names":["handleFormSubmissionResponse","Y","use","M","core_formchangechecker","reset_form_dirty_state","console","log","handleFormSubmissionFailure","data","submitFormAjax","e","preventDefault","document","createEvent","initEvent","formData","querySelector","serialize","contextid","getAttribute","call","methodname","args","jsonformdata","JSON","stringify","done","bind","fail","undefined","formdata","params","loadFragment","html","js","fadeOut","replaceNodeContents","fadeIn","on","this","getElementById","value","loadForm"],"mappings":"sfAiCMA,6BAA+B,WAGjCC,EAAEC,IAAI,iCAAiC,WACnCC,EAAEC,uBAAuBC,4BAG7BC,QAAQC,IAAI,iCAQVC,4BAA8B,SAACC,MAIjCH,QAAQC,IAAI,UAEVG,eAAiB,SAACC,GAEpBA,EAAEC,iBAEFN,QAAQC,IAAI,kBACMM,SAASC,YAAY,cAC3BC,UAAU,UAAU,GAAM,OAGlCC,UAAW,mBAAEH,SAASI,cAAc,oCAAoCC,YAC5EZ,QAAQC,IAAIS,cACRG,UAAYN,SAASI,cAAc,8BAA8BG,aAAa,gCAE7EC,KAAK,CAAC,CACPC,WAAY,8CACZC,KAAM,CAAEJ,UAAWA,UAAWK,aAAcC,KAAKC,UAAUV,WAC3DW,KAAM3B,6BAA6B4B,eAAWZ,UAC9Ca,KAAMrB,4BAA4BoB,eAAWZ,4BAMjC,SAACc,YAAWX,YAvEf,SAACY,SAAUZ,WACxBb,QAAQC,IAAI,kBACY,IAAbwB,WACPA,SAAW,QAGXC,OAAS,CAAER,aAAcC,KAAKC,UAAUK,WAC5CzB,QAAQC,IAAIY,6BAEHc,aAAa,8BAA+B,kBAAmBd,UAAWa,QAAQL,MAAK,SAAUO,KAAMC,wBAE1GtB,SAASI,cAAc,+BAA+BmB,QAAQ,QAAQ,8BAC1DC,qBAAoB,mBAAExB,SAASI,cAAc,+BAAgCiB,KAAMC,wBAC3FtB,SAASI,cAAc,+BAA+BqB,OAAO,QAC/DhC,QAAQC,KAAI,mBAAEM,SAASI,cAAc,yDACnCJ,SAASI,cAAc,sDAAsDsB,GAAG,QAAS7B,eAAekB,KAAKY,OAC/G3B,SAAS4B,eAAe,aAAaC,MAAQ7B,SAASI,cAAc,8BAA8BG,aAAa,qBAwDvHuB,CAAS,GAAIxB"}